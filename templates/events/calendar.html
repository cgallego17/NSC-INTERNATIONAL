{% extends 'base.html' %}
{% load static %}

{% block title %}Calendario de Eventos - NSC Eventos{% endblock %}

{% block breadcrumb %}
    <span>Eventos</span> / <span>Calendario</span>
{% endblock %}

{% block content %}
<div class="calendar-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1>Calendario de Eventos</h1>
        <p>Vista mensual de todos los eventos</p>
    </div>

    <!-- Calendar Navigation -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <a href="{% url 'events:list' %}" class="btn btn-corporate-outline">
                <i class="fas fa-list me-2"></i>Vista de Lista
            </a>
        </div>
        <div>
                <i class="fas fa-plus me-2"></i>Crear Evento
            </a>
        </div>
    </div>

    <!-- Calendar -->
    <div class="card">
        <div class="card-body">
            <div id="calendar"></div>
        </div>
    </div>
</div>

<!-- Event Modal -->
<div class="modal fade" id="eventModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eventModalTitle">Detalles del Evento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="eventModalBody">
                <!-- Event details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <a href="#" class="btn btn-corporate" id="eventModalLink">Ver Detalles</a>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<style>
.fc {
    font-family: inherit;
}

.fc-event {
    border-radius: 4px;
    border: none;
    padding: 2px 4px;
    font-size: 0.8rem;
}

.fc-event-title {
    font-weight: 500;
}

.fc-daygrid-event {
    margin: 1px 0;
}

.fc-toolbar-title {
    font-size: 1.5rem;
    font-weight: 600;
}

.fc-button {
    border-radius: 6px;
    font-weight: 500;
}

.fc-button-primary {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

.fc-button-primary:hover {
    background-color: var(--primary-dark);
    border-color: var(--primary-dark);
}

.fc-button-primary:focus {
    box-shadow: 0 0 0 0.2rem rgba(102, 117, 237, 0.25);
}

.fc-daygrid-day-number {
    color: var(--text-primary);
    font-weight: 500;
}

.fc-daygrid-day:hover .fc-daygrid-day-number {
    background-color: var(--sidebar-hover);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');
    
    // Event data from Django
    const events = [
        {% for event in events %}
        {
            id: {{ event.id }},
            title: "{{ event.title }}",
            start: "{{ event.start_date|date:'c' }}",
            end: "{{ event.end_date|date:'c' }}",
            allDay: {{ event.all_day|yesno:"true,false" }},
            color: "{{ event.category.color }}",
            url: "{% url 'events:detail' event.pk %}",
            extendedProps: {
                description: "{{ event.short_description|default:event.description|truncatechars:100 }}",
                location: "{{ event.location }}",
                organizer: "{{ event.organizer.get_full_name|default:event.organizer.username }}",
                status: "{{ event.status }}",
                priority: "{{ event.priority }}",
                attendees: {{ event.attendees_count }}
            }
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];
    
    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'es',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,dayGridWeek,listWeek'
        },
        events: events,
        eventClick: function(info) {
            const event = info.event;
            const modal = new bootstrap.Modal(document.getElementById('eventModal'));
            
            // Set modal title
            document.getElementById('eventModalTitle').textContent = event.title;
            
            // Set modal body
            const modalBody = document.getElementById('eventModalBody');
            modalBody.innerHTML = `
                <div class="event-details">
                    <div class="mb-3">
                        <strong>Descripción:</strong><br>
                        <span class="text-muted">${event.extendedProps.description}</span>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-2">
                                <i class="fas fa-calendar text-primary me-2"></i>
                                <strong>Fecha:</strong> ${event.start.toLocaleDateString('es-ES')}
                            </div>
                            <div class="mb-2">
                                <i class="fas fa-clock text-primary me-2"></i>
                                <strong>Hora:</strong> ${event.start.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'})} - ${event.end.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'})}
                            </div>
                        </div>
                        <div class="col-md-6">
                            ${event.extendedProps.location ? `
                                <div class="mb-2">
                                    <i class="fas fa-map-marker-alt text-primary me-2"></i>
                                    <strong>Ubicación:</strong> ${event.extendedProps.location}
                                </div>
                            ` : ''}
                            <div class="mb-2">
                                <i class="fas fa-user text-primary me-2"></i>
                                <strong>Organizador:</strong> ${event.extendedProps.organizer}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <span class="badge me-2" style="background-color: ${event.color};">
                            ${event.extendedProps.status}
                        </span>
                        <span class="badge bg-light text-dark">
                            <i class="fas fa-users me-1"></i>${event.extendedProps.attendees} asistentes
                        </span>
                    </div>
                </div>
            `;
            
            // Set modal link
            document.getElementById('eventModalLink').href = event.url;
            
            modal.show();
            
            info.jsEvent.preventDefault();
        },
        eventMouseEnter: function(info) {
            info.el.style.cursor = 'pointer';
        },
        dayMaxEvents: 3,
        moreLinkClick: 'popover',
        eventDisplay: 'block',
        height: 'auto'
    });
    
    calendar.render();
});
</script>
{% endblock %}
