<div class="tab-content-header mb-4">
    <h4 style="color: var(--mlb-blue); font-weight: 800; font-size: 1.5rem; margin-bottom: 10px;">
        <i class="fas fa-user-plus me-2" style="color: var(--mlb-red);"></i>Registrar Hijo/Jugador
    </h4>
    <p class="text-muted">Completa la información para registrar a tu hijo como jugador en el sistema</p>
</div>

{% if parent_player_form %}
    <!-- Alerta informativa minimalista -->
    <div class="alert alert-light border mb-4" style="background: #f8f9fa;">
        <div class="d-flex align-items-start">
            <i class="fas fa-info-circle me-2 mt-1" style="color: #0dcaf0;"></i>
            <div>
                <strong>Nota:</strong> Los jugadores registrados por padres <strong>NO pueden iniciar sesión</strong>. Tú gestionarás toda su información desde tu dashboard.
            </div>
        </div>
    </div>

    <div class="form-container">
        <form method="post" action="{% url 'accounts:parent_player_register' %}" enctype="multipart/form-data" id="parentPlayerForm" novalidate>
            {% csrf_token %}
            
            {% if parent_player_form.non_field_errors %}
                <div class="alert alert-danger mb-4">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    {{ parent_player_form.non_field_errors }}
                </div>
            {% endif %}
            
            <!-- Indicador de progreso minimalista -->
            <div class="mb-4" style="background: white; border-radius: 8px; padding: 15px; border: 1px solid #e9ecef;">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="text-muted small">Progreso</span>
                    <span class="text-muted small" id="formProgressText">0%</span>
                </div>
                <div class="progress" style="height: 6px; border-radius: 10px; background: #e9ecef;">
                    <div class="progress-bar" role="progressbar" id="formProgressBar" style="width: 0%; background: var(--mlb-blue); transition: width 0.3s;"></div>
                </div>
            </div>
            
            <!-- Información de Relación -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-users me-2" style="color: var(--mlb-red);"></i>Relación con el Jugador
                </h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.relationship.id_for_label }}" class="form-label required-field">
                            Relación *
                        </label>
                        {{ parent_player_form.relationship }}
                        {% if parent_player_form.relationship.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.relationship.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">
                            <i class="fas fa-question-circle me-1"></i>Tu relación legal con el jugador
                        </small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label d-block mb-2">Contacto Principal</label>
                        <div class="form-check form-switch">
                            {{ parent_player_form.is_primary }}
                            <label class="form-check-label" for="{{ parent_player_form.is_primary.id_for_label }}">
                                {{ parent_player_form.is_primary.label }}
                            </label>
                        </div>
                        {% if parent_player_form.is_primary.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.is_primary.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.is_primary.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.is_primary.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Información del Jugador -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-user me-2" style="color: var(--mlb-red);"></i>Información Personal
                </h5>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.first_name.id_for_label }}" class="form-label required-field">
                            Nombre *
                        </label>
                        {{ parent_player_form.first_name }}
                        {% if parent_player_form.first_name.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.first_name.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.last_name.id_for_label }}" class="form-label required-field">
                            Primer Apellido *
                        </label>
                        {{ parent_player_form.last_name }}
                        {% if parent_player_form.last_name.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.last_name.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.last_name2.id_for_label }}" class="form-label">
                            Segundo Apellido
                            <span class="text-muted small">(opcional)</span>
                        </label>
                        {{ parent_player_form.last_name2 }}
                        {% if parent_player_form.last_name2.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.last_name2.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.phone.id_for_label }}" class="form-label">
                            Teléfono
                            <span class="text-muted small">(opcional)</span>
                        </label>
                        {{ parent_player_form.phone }}
                        {% if parent_player_form.phone.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.phone.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">Formato: (123) 456-7890</small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.birth_date.id_for_label }}" class="form-label required-field">
                            Fecha de Nacimiento *
                        </label>
                        {{ parent_player_form.birth_date }}
                        {% if parent_player_form.birth_date.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.birth_date.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.birth_date.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.birth_date.errors }}</div>
                        {% endif %}
                        <small class="text-success d-block mt-1">
                            <i class="fas fa-magic me-1"></i>La división y grado se calcularán automáticamente
                        </small>
                    </div>
                </div>
            </div>
            
            <!-- Información Deportiva -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-baseball-ball me-2" style="color: var(--mlb-red);"></i>Información Deportiva
                </h5>
                <div class="alert alert-light border mb-3" style="background: #f8f9fa; border-color: #dee2e6 !important;">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        El equipo y número de jersey serán asignados por un administrador o manager.
                    </small>
                </div>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.position.id_for_label }}" class="form-label">
                            Posición Preferida
                        </label>
                        {{ parent_player_form.position }}
                        {% if parent_player_form.position.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.position.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.height.id_for_label }}" class="form-label">
                            Estatura
                        </label>
                        {{ parent_player_form.height }}
                        {% if parent_player_form.height.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.height.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">Ej: 5'10"</small>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.weight.id_for_label }}" class="form-label">
                            Peso (lbs)
                        </label>
                        {{ parent_player_form.weight }}
                        {% if parent_player_form.weight.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.weight.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.batting_hand.id_for_label }}" class="form-label">
                            Mano de Bateo
                        </label>
                        {{ parent_player_form.batting_hand }}
                        {% if parent_player_form.batting_hand.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.batting_hand.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.throwing_hand.id_for_label }}" class="form-label">
                            Mano de Lanzamiento
                        </label>
                        {{ parent_player_form.throwing_hand }}
                        {% if parent_player_form.throwing_hand.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.throwing_hand.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Elegibilidad y División -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-check-circle me-2" style="color: var(--mlb-red);"></i>Elegibilidad y División
                </h5>
                <div class="alert alert-warning border mb-3" style="background: #fff3cd; border-color: #ffc107 !important;">
                    <small>
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        Los jugadores sin verificación de edad aprobada no son elegibles hasta que se apruebe la documentación.
                    </small>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.grade.id_for_label }}" class="form-label">
                            Grado Actual
                        </label>
                        {{ parent_player_form.grade }}
                        {% if parent_player_form.grade.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.grade.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.grade.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.grade.errors }}</div>
                        {% endif %}
                        <small class="text-success d-block mt-1">
                            <i class="fas fa-magic me-1"></i>Se calculará automáticamente
                        </small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.division.id_for_label }}" class="form-label">
                            División Asignada
                        </label>
                        {{ parent_player_form.division }}
                        {% if parent_player_form.division.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.division.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.division.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.division.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">Asignada automáticamente o por administrador</small>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="{{ parent_player_form.age_verification_document.id_for_label }}" class="form-label required-field">
                        Documento de Verificación de Edad *
                    </label>
                    <div class="file-upload-area" style="border: 2px dashed #dee2e6; border-radius: 8px; padding: 20px; text-align: center; background: #f8f9fa; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--mlb-blue)'; this.style.background='#e7f3ff';" onmouseout="this.style.borderColor='#dee2e6'; this.style.background='#f8f9fa';">
                        <i class="fas fa-cloud-upload-alt fa-2x mb-2" style="color: var(--mlb-blue);"></i>
                        <p class="mb-1" style="font-weight: 500; color: var(--mlb-blue);">Haz clic para subir el documento</p>
                        <small class="text-muted">PDF, JPG, PNG (máx. 10MB)</small>
                        {{ parent_player_form.age_verification_document }}
                    </div>
                    {% if parent_player_form.age_verification_document.help_text %}
                        <small class="text-muted d-block mt-2">
                            <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.age_verification_document.help_text }}
                        </small>
                    {% endif %}
                    {% if parent_player_form.age_verification_document.errors %}
                        <div class="error-message mt-2">{{ parent_player_form.age_verification_document.errors }}</div>
                    {% endif %}
                    <small class="text-muted d-block mt-2">Certificado de nacimiento, pasaporte o ID (original o digital)</small>
                </div>
            </div>
            
            <!-- Tallas de Uniformes -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-tshirt me-2" style="color: var(--mlb-red);"></i>Tallas de Uniformes
                </h5>
                <div class="alert alert-light border mb-3" style="background: #f8f9fa; border-color: #dee2e6 !important;">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        Selecciona las tallas correspondientes. Puedes dejarlas en blanco y actualizarlas más tarde.
                    </small>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.jersey_size.id_for_label }}" class="form-label">
                            Talla de Jersey
                        </label>
                        {{ parent_player_form.jersey_size }}
                        {% if parent_player_form.jersey_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.jersey_size.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.hat_size.id_for_label }}" class="form-label">
                            Talla de Gorra
                        </label>
                        {{ parent_player_form.hat_size }}
                        {% if parent_player_form.hat_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.hat_size.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.batting_glove_size.id_for_label }}" class="form-label">
                            Talla de Guante de Bateo
                        </label>
                        {{ parent_player_form.batting_glove_size }}
                        {% if parent_player_form.batting_glove_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.batting_glove_size.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.batting_helmet_size.id_for_label }}" class="form-label">
                            Talla de Casco de Bateo
                        </label>
                        {{ parent_player_form.batting_helmet_size }}
                        {% if parent_player_form.batting_helmet_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.batting_helmet_size.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.shorts_size.id_for_label }}" class="form-label">
                            Talla de Pantalones
                        </label>
                        {{ parent_player_form.shorts_size }}
                        {% if parent_player_form.shorts_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.shorts_size.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Contacto de Emergencia -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-phone-alt me-2" style="color: var(--mlb-red);"></i>Contacto de Emergencia
                </h5>
                <div class="alert alert-light border mb-3" style="background: #f8f9fa; border-color: #dee2e6 !important;">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        Información utilizada únicamente en caso de emergencia médica.
                    </small>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.emergency_contact_name.id_for_label }}" class="form-label">
                            Nombre del Contacto
                        </label>
                        {{ parent_player_form.emergency_contact_name }}
                        {% if parent_player_form.emergency_contact_name.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.emergency_contact_name.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.emergency_contact_phone.id_for_label }}" class="form-label">
                            Teléfono de Emergencia
                        </label>
                        {{ parent_player_form.emergency_contact_phone }}
                        {% if parent_player_form.emergency_contact_phone.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.emergency_contact_phone.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">Número disponible 24/7</small>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.emergency_contact_relation.id_for_label }}" class="form-label">
                            Relación con el Jugador
                        </label>
                        {{ parent_player_form.emergency_contact_relation }}
                        {% if parent_player_form.emergency_contact_relation.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.emergency_contact_relation.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="{{ parent_player_form.medical_conditions.id_for_label }}" class="form-label">
                        Condiciones Médicas
                    </label>
                    {{ parent_player_form.medical_conditions }}
                    {% if parent_player_form.medical_conditions.errors %}
                        <div class="error-message mt-1">{{ parent_player_form.medical_conditions.errors }}</div>
                    {% endif %}
                    <small class="text-muted d-block mt-1">
                        <i class="fas fa-info-circle me-1"></i>
                        Alergias, asma, medicamentos, etc. Si no hay condiciones, escribe "Ninguna".
                    </small>
                </div>
            </div>
            
            <!-- Botones de Acción -->
            <div class="form-actions mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <div class="d-flex justify-content-between align-items-center">
                    <a href="{% url 'accounts:panel' %}" class="btn btn-form-cancel">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </a>
                    <button type="submit" class="btn btn-form-submit">
                        <i class="fas fa-save me-2"></i>Registrar Jugador
                    </button>
                </div>
            </div>
        </form>
    </div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Calcular progreso del formulario (minimalista)
    function updateFormProgress() {
        const form = document.getElementById('parentPlayerForm');
        if (!form) return;
        
        const requiredFields = form.querySelectorAll('[required], .required-field').length;
        const filledFields = Array.from(form.querySelectorAll('[required], .required-field')).filter(field => {
            const input = field.tagName === 'LABEL' ? 
                document.getElementById(field.getAttribute('for')) : field;
            if (input && (input.tagName === 'INPUT' || input.tagName === 'SELECT' || input.tagName === 'TEXTAREA')) {
                return input.value && input.value.trim() !== '';
            }
            return false;
        }).length;
        
        const progress = requiredFields > 0 ? (filledFields / requiredFields) * 100 : 0;
        const progressBar = document.getElementById('formProgressBar');
        const progressText = document.getElementById('formProgressText');
        
        if (progressBar) {
            progressBar.style.width = progress + '%';
        }
        
        if (progressText) {
            progressText.textContent = Math.round(progress) + '%';
        }
    }
    
    // Actualizar progreso cuando cambian los campos
    const form = document.getElementById('parentPlayerForm');
    if (form) {
        form.addEventListener('input', updateFormProgress);
        form.addEventListener('change', updateFormProgress);
        updateFormProgress();
    }
    
    // Mejorar el área de carga de archivos
    const fileInput = document.querySelector('#parentPlayerForm input[type="file"]');
    const fileUploadArea = document.querySelector('.file-upload-area');
    
    if (fileInput && fileUploadArea) {
        fileUploadArea.addEventListener('click', function() {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const fileName = file.name;
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                fileUploadArea.innerHTML = `
                    <i class="fas fa-check-circle fa-2x mb-2" style="color: #28a745;"></i>
                    <p class="mb-1" style="font-weight: 500; color: var(--mlb-blue);">${fileName}</p>
                    <small class="text-muted">${fileSize} MB</small>
                    <input type="file" name="${fileInput.name}" id="${fileInput.id}" style="display: none;">
                `;
                fileUploadArea.style.borderColor = '#28a745';
                fileUploadArea.style.background = '#d4edda';
                
                // Re-attach event listener
                const newFileInput = fileUploadArea.querySelector('input[type="file"]');
                if (newFileInput) {
                    newFileInput.addEventListener('change', arguments.callee);
                }
            }
        });
    }
});
</script>
