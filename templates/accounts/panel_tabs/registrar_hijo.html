<div class="tab-content-header mb-4">
    <h4 style="color: var(--mlb-blue); font-weight: 800; font-size: 1.5rem; margin-bottom: 10px;">
        <i class="fas fa-user-plus me-2" style="color: var(--mlb-red);"></i>Registrar Hijo/Jugador
    </h4>
    <p class="text-muted">Completa la informaci√≥n para registrar a tu hijo como jugador en el sistema</p>
</div>

{% if parent_player_form %}
    <!-- Alerta informativa minimalista -->
    <div class="alert alert-light border mb-4 alert-persistent" style="background: #f8f9fa;">
        <div class="d-flex align-items-start">
            <i class="fas fa-info-circle me-2 mt-1" style="color: #0dcaf0;"></i>
            <div>
                <strong>Nota:</strong> Los jugadores registrados por padres <strong>NO pueden iniciar sesi√≥n</strong>. T√∫ gestionar√°s toda su informaci√≥n desde tu dashboard.
            </div>
        </div>
    </div>

    <div class="form-container">
        <form method="post" action="{% url 'accounts:parent_player_register' %}" enctype="multipart/form-data" id="parentPlayerForm" novalidate>
            {% csrf_token %}
            
            {% if parent_player_form.non_field_errors %}
                <div class="alert alert-danger mb-4 alert-persistent">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    {{ parent_player_form.non_field_errors }}
                </div>
            {% endif %}
            
            <!-- Indicador de progreso minimalista -->
            <div class="mb-4" style="background: white; border-radius: 8px; padding: 15px; border: 1px solid #e9ecef;">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="text-muted small">Progreso</span>
                    <span class="text-muted small" id="formProgressText">0%</span>
                </div>
                <div class="progress" style="height: 6px; border-radius: 10px; background: #e9ecef;">
                    <div class="progress-bar" role="progressbar" id="formProgressBar" style="width: 0%; background: var(--mlb-blue); transition: width 0.3s;"></div>
                </div>
            </div>
            
            <!-- Informaci√≥n de Relaci√≥n -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-users me-2" style="color: var(--mlb-red);"></i>Relaci√≥n con el Jugador
                </h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.relationship.id_for_label }}" class="form-label required-field">
                            Relaci√≥n *
                        </label>
                        {{ parent_player_form.relationship }}
                        {% if parent_player_form.relationship.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.relationship.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">
                            <i class="fas fa-question-circle me-1"></i>Tu relaci√≥n legal con el jugador
                        </small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label d-block mb-2">Contacto Principal</label>
                        <div class="form-check form-switch">
                            {{ parent_player_form.is_primary }}
                            <label class="form-check-label" for="{{ parent_player_form.is_primary.id_for_label }}">
                                {{ parent_player_form.is_primary.label }}
                            </label>
                        </div>
                        {% if parent_player_form.is_primary.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.is_primary.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.is_primary.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.is_primary.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Informaci√≥n del Jugador -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-user me-2" style="color: var(--mlb-red);"></i>Informaci√≥n Personal
                </h5>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.first_name.id_for_label }}" class="form-label required-field">
                            Nombre *
                        </label>
                        {{ parent_player_form.first_name }}
                        {% if parent_player_form.first_name.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.first_name.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.last_name.id_for_label }}" class="form-label required-field">
                            Primer Apellido *
                        </label>
                        {{ parent_player_form.last_name }}
                        {% if parent_player_form.last_name.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.last_name.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.last_name2.id_for_label }}" class="form-label">
                            Segundo Apellido
                            <span class="text-muted small">(opcional)</span>
                        </label>
                        {{ parent_player_form.last_name2 }}
                        {% if parent_player_form.last_name2.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.last_name2.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.phone.id_for_label }}" class="form-label">
                            Tel√©fono
                            <span class="text-muted small">(opcional)</span>
                        </label>
                        {{ parent_player_form.phone }}
                        {% if parent_player_form.phone.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.phone.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">Formato: (123) 456-7890</small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.birth_date.id_for_label }}" class="form-label required-field">
                            Fecha de Nacimiento *
                        </label>
                        {{ parent_player_form.birth_date }}
                        {% if parent_player_form.birth_date.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.birth_date.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.birth_date.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.birth_date.errors }}</div>
                        {% endif %}
                        <small class="text-success d-block mt-1">
                            <i class="fas fa-magic me-1"></i>La divisi√≥n y grado se calcular√°n autom√°ticamente
                        </small>
                    </div>
                    
                </div>
            </div>
            
            <!-- Informaci√≥n Deportiva -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-baseball-ball me-2" style="color: var(--mlb-red);"></i>Informaci√≥n Deportiva
                </h5>
                <div class="alert alert-light border mb-3 alert-persistent" style="background: #f8f9fa; border-color: #dee2e6 !important;">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        El equipo y n√∫mero de jersey ser√°n asignados por un administrador o manager.
                    </small>
                </div>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.position.id_for_label }}" class="form-label">
                            Posici√≥n Preferida
                        </label>
                        {{ parent_player_form.position }}
                        {% if parent_player_form.position.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.position.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.height.id_for_label }}" class="form-label">
                            Estatura
                        </label>
                        {{ parent_player_form.height }}
                        {% if parent_player_form.height.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.height.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">Ej: 5'10"</small>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.weight.id_for_label }}" class="form-label">
                            Peso (lbs)
                        </label>
                        {{ parent_player_form.weight }}
                        {% if parent_player_form.weight.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.weight.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.batting_hand.id_for_label }}" class="form-label">
                            Mano de Bateo
                        </label>
                        {{ parent_player_form.batting_hand }}
                        {% if parent_player_form.batting_hand.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.batting_hand.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.throwing_hand.id_for_label }}" class="form-label">
                            Mano de Lanzamiento
                        </label>
                        {{ parent_player_form.throwing_hand }}
                        {% if parent_player_form.throwing_hand.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.throwing_hand.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Elegibilidad y Divisi√≥n -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-check-circle me-2" style="color: var(--mlb-red);"></i>Elegibilidad y Divisi√≥n
                </h5>
                <div class="alert alert-warning border mb-3 alert-persistent" style="background: #fff3cd; border-color: #ffc107 !important;">
                    <small>
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        Los jugadores sin verificaci√≥n de edad aprobada no son elegibles hasta que se apruebe la documentaci√≥n.
                    </small>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.grade.id_for_label }}" class="form-label">
                            Grado Actual
                        </label>
                        {{ parent_player_form.grade }}
                        {% if parent_player_form.grade.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.grade.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.grade.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.grade.errors }}</div>
                        {% endif %}
                        <small class="text-success d-block mt-1">
                            <i class="fas fa-magic me-1"></i>Se calcular√° autom√°ticamente
                        </small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.division.id_for_label }}" class="form-label">
                            Divisi√≥n Asignada
                        </label>
                        {{ parent_player_form.division }}
                        {% if parent_player_form.division.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.division.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.division.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.division.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">Asignada autom√°ticamente o por administrador</small>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="{{ parent_player_form.age_verification_document.id_for_label }}" class="form-label required-field">
                        Documento de Verificaci√≥n de Edad *
                    </label>
                    <div class="file-upload-area" style="border: 2px dashed #dee2e6; border-radius: 8px; padding: 20px; text-align: center; background: #f8f9fa; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.borderColor='var(--mlb-blue)'; this.style.background='#e7f3ff';" onmouseout="this.style.borderColor='#dee2e6'; this.style.background='#f8f9fa';">
                        <i class="fas fa-cloud-upload-alt fa-2x mb-2" style="color: var(--mlb-blue);"></i>
                        <p class="mb-1" style="font-weight: 500; color: var(--mlb-blue);">Haz clic para subir el documento</p>
                        <small class="text-muted">PDF, JPG, PNG (m√°x. 10MB)</small>
                        {{ parent_player_form.age_verification_document }}
                    </div>
                    {% if parent_player_form.age_verification_document.help_text %}
                        <small class="text-muted d-block mt-2">
                            <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.age_verification_document.help_text }}
                        </small>
                    {% endif %}
                    {% if parent_player_form.age_verification_document.errors %}
                        <div class="error-message mt-2">{{ parent_player_form.age_verification_document.errors }}</div>
                    {% endif %}
                    <small class="text-muted d-block mt-2">Certificado de nacimiento, pasaporte o ID (original o digital)</small>
                </div>
            </div>
            
            <!-- Tallas de Uniformes -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-tshirt me-2" style="color: var(--mlb-red);"></i>Tallas de Uniformes
                </h5>
                <div class="alert alert-light border mb-3 alert-persistent" style="background: #f8f9fa; border-color: #dee2e6 !important;">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        Selecciona las tallas correspondientes. Puedes dejarlas en blanco y actualizarlas m√°s tarde.
                    </small>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.jersey_size.id_for_label }}" class="form-label">
                            Talla de Jersey
                        </label>
                        {{ parent_player_form.jersey_size }}
                        {% if parent_player_form.jersey_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.jersey_size.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.hat_size.id_for_label }}" class="form-label">
                            Talla de Gorra
                        </label>
                        {{ parent_player_form.hat_size }}
                        {% if parent_player_form.hat_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.hat_size.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.batting_glove_size.id_for_label }}" class="form-label">
                            Talla de Guante de Bateo
                        </label>
                        {{ parent_player_form.batting_glove_size }}
                        {% if parent_player_form.batting_glove_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.batting_glove_size.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.batting_helmet_size.id_for_label }}" class="form-label">
                            Talla de Casco de Bateo
                        </label>
                        {{ parent_player_form.batting_helmet_size }}
                        {% if parent_player_form.batting_helmet_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.batting_helmet_size.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.shorts_size.id_for_label }}" class="form-label">
                            Talla de Pantalones
                        </label>
                        {{ parent_player_form.shorts_size }}
                        {% if parent_player_form.shorts_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.shorts_size.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Contacto de Emergencia -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-phone-alt me-2" style="color: var(--mlb-red);"></i>Contacto de Emergencia
                </h5>
                <div class="alert alert-light border mb-3 alert-persistent" style="background: #f8f9fa; border-color: #dee2e6 !important;">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        Informaci√≥n utilizada √∫nicamente en caso de emergencia m√©dica.
                    </small>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.emergency_contact_name.id_for_label }}" class="form-label">
                            Nombre del Contacto
                        </label>
                        {{ parent_player_form.emergency_contact_name }}
                        {% if parent_player_form.emergency_contact_name.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.emergency_contact_name.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.emergency_contact_phone.id_for_label }}" class="form-label">
                            Tel√©fono de Emergencia
                        </label>
                        {{ parent_player_form.emergency_contact_phone }}
                        {% if parent_player_form.emergency_contact_phone.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.emergency_contact_phone.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">N√∫mero disponible 24/7</small>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.emergency_contact_relation.id_for_label }}" class="form-label">
                            Relaci√≥n con el Jugador
                        </label>
                        {{ parent_player_form.emergency_contact_relation }}
                        {% if parent_player_form.emergency_contact_relation.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.emergency_contact_relation.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="{{ parent_player_form.medical_conditions.id_for_label }}" class="form-label">
                        Condiciones M√©dicas
                    </label>
                    {{ parent_player_form.medical_conditions }}
                    {% if parent_player_form.medical_conditions.errors %}
                        <div class="error-message mt-1">{{ parent_player_form.medical_conditions.errors }}</div>
                    {% endif %}
                    <small class="text-muted d-block mt-1">
                        <i class="fas fa-info-circle me-1"></i>
                        Alergias, asma, medicamentos, etc. Si no hay condiciones, escribe "Ninguna".
                    </small>
                </div>
            </div>
            
            <!-- Botones de Acci√≥n -->
            <div class="form-actions mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <div class="d-flex justify-content-between align-items-center">
                    <a href="{% url 'accounts:panel' %}" class="btn btn-form-cancel">
                        <i class="fas fa-times me-2"></i>Cancelar
                    </a>
                    <button type="submit" class="btn btn-form-submit">
                        <i class="fas fa-save me-2"></i>Registrar Jugador
                    </button>
                </div>
            </div>
        </form>
    </div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ Formulario de registro de hijo cargado');
    
    // ========== TEST COMPLETO DEL FORMULARIO ==========
    function testFormulario() {
        const tests = {
            camposRequeridos: false,
            calculoAutomatico: false,
            progresoFormulario: false,
            cargaArchivos: false,
            validaciones: false
        };
        
        // Test 1: Verificar campos requeridos
        const requiredFields = [
            'id_relationship',
            'id_first_name',
            'id_last_name',
            'id_birth_date',
            'id_age_verification_document'
        ];
        
        let camposEncontrados = 0;
        requiredFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                camposEncontrados++;
                console.log(`‚úÖ Campo requerido encontrado: ${fieldId}`);
            } else {
                console.error(`‚ùå Campo requerido NO encontrado: ${fieldId}`);
            }
        });
        
        tests.camposRequeridos = camposEncontrados === requiredFields.length;
        console.log(`üìä Campos requeridos: ${camposEncontrados}/${requiredFields.length}`);
        
        // Test 2: Verificar c√°lculo autom√°tico de edad/divisi√≥n/grado
        const birthDateField = document.getElementById('id_birth_date');
        const gradeField = document.getElementById('id_grade');
        const divisionField = document.getElementById('id_division');
        
        if (birthDateField && gradeField && divisionField) {
            tests.calculoAutomatico = true;
            console.log('‚úÖ Campos de c√°lculo autom√°tico encontrados');
        } else {
            console.error('‚ùå Faltan campos para c√°lculo autom√°tico');
        }
        
        // Test 3: Verificar indicador de progreso
        const progressBar = document.getElementById('formProgressBar');
        const progressText = document.getElementById('formProgressText');
        
        if (progressBar && progressText) {
            tests.progresoFormulario = true;
            console.log('‚úÖ Indicador de progreso encontrado');
        } else {
            console.error('‚ùå Indicador de progreso NO encontrado');
        }
        
        // Test 4: Verificar carga de archivos
        const fileInput = document.querySelector('#parentPlayerForm input[type="file"]');
        const fileUploadArea = document.querySelector('.file-upload-area');
        
        if (fileInput && fileUploadArea) {
            tests.cargaArchivos = true;
            console.log('‚úÖ √Årea de carga de archivos encontrada');
        } else {
            console.error('‚ùå √Årea de carga de archivos NO encontrada');
        }
        
        // Test 5: Verificar validaciones HTML5
        const form = document.getElementById('parentPlayerForm');
        if (form && form.hasAttribute('novalidate')) {
            tests.validaciones = true;
            console.log('‚úÖ Formulario configurado para validaci√≥n personalizada');
        }
        
        // Resumen de tests
        console.log('\nüìã RESUMEN DE TESTS:');
        console.log('===================');
        Object.keys(tests).forEach(test => {
            const icon = tests[test] ? '‚úÖ' : '‚ùå';
            console.log(`${icon} ${test}: ${tests[test] ? 'PASADO' : 'FALLIDO'}`);
        });
        
        const todosPasados = Object.values(tests).every(test => test === true);
        if (todosPasados) {
            console.log('\nüéâ ¬°TODOS LOS TESTS PASARON!');
        } else {
            console.log('\n‚ö†Ô∏è ALGUNOS TESTS FALLARON');
        }
        
        return tests;
    }
    
    // Ejecutar tests despu√©s de un breve delay para asegurar que todo est√© cargado
    setTimeout(testFormulario, 500);
    
    // ========== FUNCIONALIDAD DEL FORMULARIO ==========
    
    // Calcular progreso del formulario
    function updateFormProgress() {
        const form = document.getElementById('parentPlayerForm');
        if (!form) return;
        
        // Obtener todos los campos requeridos
        const requiredInputs = form.querySelectorAll('input[required], select[required], textarea[required]');
        const requiredLabels = form.querySelectorAll('.required-field');
        
        let totalRequired = requiredInputs.length;
        requiredLabels.forEach(label => {
            const fieldId = label.getAttribute('for');
            if (fieldId) {
                const field = document.getElementById(fieldId);
                if (field && !field.hasAttribute('required')) {
                    totalRequired++;
                }
            }
        });
        
        // Contar campos llenos
        let filledCount = 0;
        requiredInputs.forEach(input => {
            if (input.value && input.value.trim() !== '') {
                filledCount++;
            }
        });
        
        requiredLabels.forEach(label => {
            const fieldId = label.getAttribute('for');
            if (fieldId) {
                const field = document.getElementById(fieldId);
                if (field && !field.hasAttribute('required') && field.value && field.value.trim() !== '') {
                    filledCount++;
                }
            }
        });
        
        const progress = totalRequired > 0 ? (filledCount / totalRequired) * 100 : 0;
        const progressBar = document.getElementById('formProgressBar');
        const progressText = document.getElementById('formProgressText');
        
        if (progressBar) {
            progressBar.style.width = progress + '%';
        }
        
        if (progressText) {
            progressText.textContent = Math.round(progress) + '%';
        }
    }
    
    // Actualizar progreso cuando cambian los campos
    const form = document.getElementById('parentPlayerForm');
    if (form) {
        form.addEventListener('input', updateFormProgress);
        form.addEventListener('change', updateFormProgress);
        updateFormProgress();
    }
    
    // C√°lculo autom√°tico de divisi√≥n y grado basado en fecha de nacimiento
    const birthDateField = document.getElementById('id_birth_date');
    const gradeField = document.getElementById('id_grade');
    const divisionField = document.getElementById('id_division');
    
    // Campo de fecha simple - el navegador maneja el formato local autom√°ticamente
    if (birthDateField) {
        // Asegurar que sea tipo date para mostrar calendario
        birthDateField.type = 'date';
    }
    
    if (birthDateField && gradeField && divisionField) {
        
        function calculateAgeAsOfApril30(birthDate) {
            if (!birthDate) return null;
            
            const date = new Date(birthDate);
            
            if (isNaN(date.getTime())) {
                return null;
            }
            
            const today = new Date();
            const currentYear = today.getFullYear();
            const cutoffDate = new Date(currentYear, 3, 30); // Mes 3 = abril (0-indexed)
            
            let age = cutoffDate.getFullYear() - date.getFullYear();
            const monthDiff = cutoffDate.getMonth() - date.getMonth();
            
            if (monthDiff < 0 || (monthDiff === 0 && cutoffDate.getDate() < date.getDate())) {
                age -= 1;
            }
            
            return age;
        }
        
        function getAgeBasedDivision(age) {
            if (age === null || age === undefined || age < 5) return null;
            if (age >= 18) return '18U';
            
            const divisionMap = {
                5: '05U', 6: '06U', 7: '07U', 8: '08U', 9: '09U',
                10: '10U', 11: '11U', 12: '12U', 13: '13U', 14: '14U',
                15: '15U', 16: '16U', 17: '17U',
            };
            
            return divisionMap[age] || null;
        }
        
        function suggestGradeFromAge(age) {
            if (age === null || age === undefined) return null;
            
            const ageToGradeMap = {
                4: 'pre_k', 5: 'kindergarten', 6: '1st', 7: '2nd', 8: '3rd',
                9: '4th', 10: '5th', 11: '6th', 12: '7th', 13: '8th',
                14: '9th', 15: '10th', 16: '11th', 17: '12th', 18: '12th',
            };
            
            return ageToGradeMap[age] || null;
        }
        
        function updateDivisionAndGrade() {
            const birthDateValue = birthDateField.value;
            
            if (!birthDateValue) {
                if (divisionField && !divisionField.value) divisionField.value = '';
                if (gradeField && !gradeField.value) gradeField.value = '';
                return;
            }
            
            const birthDate = new Date(birthDateValue);
            
            if (isNaN(birthDate.getTime())) {
                return;
            }
            
            const age = calculateAgeAsOfApril30(birthDateValue);
            
            if (age !== null) {
                const suggestedDivision = getAgeBasedDivision(age);
                const suggestedGrade = suggestGradeFromAge(age);
                
                // Actualizar divisi√≥n
                if (divisionField && suggestedDivision) {
                    if (!divisionField.value || divisionField.value === '') {
                        divisionField.value = suggestedDivision;
                        divisionField.dataset.autoSet = 'true';
                        console.log(`‚úÖ Divisi√≥n calculada autom√°ticamente: ${suggestedDivision}`);
                    } else if (divisionField.dataset.autoSet === 'true') {
                        divisionField.value = suggestedDivision;
                    }
                }
                
                // Actualizar grado
                if (gradeField && suggestedGrade) {
                    const optionExists = Array.from(gradeField.options).some(opt => opt.value === suggestedGrade);
                    if (optionExists) {
                        const isEmpty = !gradeField.value || gradeField.value === '' || gradeField.value === null;
                        if (isEmpty || gradeField.selectedIndex === 0) {
                            gradeField.value = suggestedGrade;
                            gradeField.dataset.autoSet = 'true';
                            gradeField.dispatchEvent(new Event('change', { bubbles: true }));
                            console.log(`‚úÖ Grado calculado autom√°ticamente: ${suggestedGrade}`);
                        } else if (gradeField.dataset.autoSet === 'true') {
                            gradeField.value = suggestedGrade;
                            gradeField.dispatchEvent(new Event('change', { bubbles: true }));
                        }
                    }
                }
            }
        }
        
        birthDateField.addEventListener('change', updateDivisionAndGrade);
        birthDateField.addEventListener('blur', updateDivisionAndGrade);
        birthDateField.addEventListener('input', function() {
            if (this.value) {
                setTimeout(updateDivisionAndGrade, 100);
            }
        });
        
        if (birthDateField.value) {
            updateDivisionAndGrade();
        }
    }
    
    // Mejorar el √°rea de carga de archivos
    const fileInput = document.querySelector('#parentPlayerForm input[type="file"]');
    const fileUploadArea = document.querySelector('.file-upload-area');
    
    if (fileInput && fileUploadArea) {
        fileUploadArea.addEventListener('click', function() {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const fileName = file.name;
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                
                // Validar tama√±o (m√°x 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert('El archivo es demasiado grande. El tama√±o m√°ximo es 10MB.');
                    fileInput.value = '';
                    return;
                }
                
                // Validar tipo de archivo
                const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
                if (!allowedTypes.includes(file.type)) {
                    alert('Tipo de archivo no permitido. Solo se aceptan PDF, JPG y PNG.');
                    fileInput.value = '';
                    return;
                }
                
                fileUploadArea.innerHTML = `
                    <i class="fas fa-check-circle fa-2x mb-2" style="color: #28a745;"></i>
                    <p class="mb-1" style="font-weight: 500; color: var(--mlb-blue);">${fileName}</p>
                    <small class="text-muted">${fileSize} MB</small>
                    <input type="file" name="${fileInput.name}" id="${fileInput.id}" style="display: none;" accept="${fileInput.accept}">
                `;
                fileUploadArea.style.borderColor = '#28a745';
                fileUploadArea.style.background = '#d4edda';
                
                console.log(`‚úÖ Archivo cargado: ${fileName} (${fileSize} MB)`);
                
                // Re-attach event listener
                const newFileInput = fileUploadArea.querySelector('input[type="file"]');
                if (newFileInput) {
                    newFileInput.addEventListener('change', arguments.callee);
                }
                
                updateFormProgress();
            }
        });
    }
    
    // Validaci√≥n antes de enviar
    if (form) {
        form.addEventListener('submit', function(e) {
            console.log('üì§ Intentando enviar formulario...');
            
            // Verificar campos requeridos
            const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');
            let isValid = true;
            let missingFields = [];
            
            requiredFields.forEach(field => {
                if (!field.value || field.value.trim() === '') {
                    isValid = false;
                    const label = form.querySelector(`label[for="${field.id}"]`);
                    const fieldName = label ? label.textContent.trim() : field.name;
                    missingFields.push(fieldName);
                    field.classList.add('is-invalid');
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                alert('Por favor, completa todos los campos requeridos:\n\n' + missingFields.join('\n'));
                console.error('‚ùå Formulario inv√°lido. Campos faltantes:', missingFields);
                return false;
            }
            
            console.log('‚úÖ Formulario v√°lido, enviando...');
        });
    }
});
</script>
