{% load i18n %}
<div class="tab-content-header mb-4">
    <h4 style="color: var(--mlb-blue); font-weight: 800; font-size: 1.5rem; margin-bottom: 10px;">
        <i class="fas fa-user-plus me-2" style="color: var(--mlb-red);"></i>{% trans "Register Child/Player" %}
    </h4>
    <p class="text-muted">{% trans "Complete the information to register your child as a player in the system" %}</p>
</div>

{% if parent_player_form %}
    <!-- Alerta informativa minimalista -->
    <div class="alert alert-light border mb-4 alert-persistent" style="background: #f8f9fa;">
        <div class="d-flex align-items-start">
            <i class="fas fa-info-circle me-2 mt-1" style="color: #0dcaf0;"></i>
            <div>
                <strong>{% trans "Note:" %}</strong> {% trans "Players registered by parents" %} <strong>{% trans "CANNOT log in" %}</strong>. {% trans "You will manage all their information from your dashboard." %}
            </div>
        </div>
    </div>

    <div class="form-container">
        <form method="post" action="{% url 'accounts:parent_player_register' %}?next=panel" enctype="multipart/form-data" id="parentPlayerForm" novalidate>
            {% csrf_token %}

            {% if parent_player_form.non_field_errors %}
                <div class="alert alert-danger mb-4 alert-persistent">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    {{ parent_player_form.non_field_errors }}
                </div>
            {% endif %}

            <!-- Información de Relación -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-users me-2" style="color: var(--mlb-red);"></i>{% trans "Relationship with Player" %}
                </h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.relationship.id_for_label }}" class="form-label required-field">
                            {% trans "Relationship" %} *
                        </label>
                        {{ parent_player_form.relationship }}
                        {% if parent_player_form.relationship.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.relationship.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">
                            <i class="fas fa-question-circle me-1"></i>{% trans "Your legal relationship with the player" %}
                        </small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label d-block mb-2">{% trans "Primary Contact" %}</label>
                        <div class="form-check form-switch">
                            {{ parent_player_form.is_primary }}
                            <label class="form-check-label" for="{{ parent_player_form.is_primary.id_for_label }}">
                                {{ parent_player_form.is_primary.label }}
                            </label>
                        </div>
                        {% if parent_player_form.is_primary.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.is_primary.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.is_primary.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.is_primary.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Información del Jugador -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-user me-2" style="color: var(--mlb-red);"></i>{% trans "Personal Information" %}
                </h5>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.first_name.id_for_label }}" class="form-label required-field">
                            {% trans "First Name" %} *
                        </label>
                        {{ parent_player_form.first_name }}
                        {% if parent_player_form.first_name.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.first_name.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.last_name.id_for_label }}" class="form-label required-field">
                            {% trans "Last Name" %} *
                        </label>
                        {{ parent_player_form.last_name }}
                        {% if parent_player_form.last_name.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.last_name.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.last_name2.id_for_label }}" class="form-label">
                            {% trans "Second Last Name" %}
                            <span class="text-muted small">({% trans "optional" %})</span>
                        </label>
                        {{ parent_player_form.last_name2 }}
                        {% if parent_player_form.last_name2.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.last_name2.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.phone.id_for_label }}" class="form-label">
                            {% trans "Phone" %}
                            <span class="text-muted small">({% trans "optional" %})</span>
                        </label>
                        {{ parent_player_form.phone }}
                        {% if parent_player_form.phone.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.phone.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">{% trans "Format: (123) 456-7890" %}</small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.birth_date.id_for_label }}" class="form-label required-field">
                            {% trans "Birth Date" %} *
                        </label>
                        {{ parent_player_form.birth_date }}
                        {% if parent_player_form.birth_date.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.birth_date.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.birth_date.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.birth_date.errors }}</div>
                        {% endif %}
                        <small class="text-success d-block mt-1">
                            <i class="fas fa-magic me-1"></i>{% trans "Division and grade will be calculated automatically" %}
                        </small>
                    </div>
                </div>

                <!-- Foto de Perfil -->
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label for="{{ parent_player_form.profile_picture.id_for_label }}" class="form-label">
                            <i class="fas fa-camera me-2"></i>{% trans "Profile Picture" %}
                            <span class="text-muted small">({% trans "optional" %})</span>
                        </label>
                        <div class="profile-picture-upload-area-panel" id="profilePictureUploadAreaPanel" style="border: 2px dashed #0d2c54; border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.3s; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                            <div>
                                <i class="fas fa-camera fa-3x mb-3" style="color: #0d2c54; opacity: 0.5;"></i>
                                <p class="mb-2" style="font-weight: 600; color: var(--mlb-blue); font-size: 1.05rem;">
                                    {% trans "Upload Profile Picture" %}
                                </p>
                                <small class="text-muted">{% trans "Click here to select an image" %}</small>
                            </div>
                        </div>
                        {{ parent_player_form.profile_picture }}
                        {% if parent_player_form.profile_picture.errors %}
                            <div class="error-message mt-2">{{ parent_player_form.profile_picture.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-2">
                            <i class="fas fa-info-circle me-1"></i>{% trans "Accepted formats: JPG, PNG, GIF. Max size: 5MB" %}
                        </small>
                    </div>
                </div>

                <!-- Ubicación -->
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.country.id_for_label }}" class="form-label required-field">
                            <i class="fas fa-globe me-1"></i>{% trans "Country" %} *
                        </label>
                        {{ parent_player_form.country }}
                        {% if parent_player_form.country.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.country.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.state.id_for_label }}" class="form-label required-field">
                            <i class="fas fa-map-marker-alt me-1"></i>{% trans "State" %} *
                        </label>
                        <div class="position-relative">
                            {{ parent_player_form.state }}
                            <div id="stateLoader" class="position-absolute" style="display: none; right: 10px; top: 50%; transform: translateY(-50%); pointer-events: none;">
                                <i class="fas fa-spinner fa-spin" style="color: var(--mlb-blue);"></i>
                            </div>
                        </div>
                        {% if parent_player_form.state.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.state.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.city.id_for_label }}" class="form-label required-field">
                            <i class="fas fa-city me-1"></i>{% trans "City" %} *
                        </label>
                        <div class="position-relative">
                            {{ parent_player_form.city }}
                            <div id="cityLoader" class="position-absolute" style="display: none; right: 10px; top: 50%; transform: translateY(-50%); pointer-events: none;">
                                <i class="fas fa-spinner fa-spin" style="color: var(--mlb-blue);"></i>
                            </div>
                        </div>
                        {% if parent_player_form.city.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.city.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Información Deportiva -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-baseball-ball me-2" style="color: var(--mlb-red);"></i>{% trans "Sports Information" %}
                </h5>
                <div class="alert alert-light border mb-3 alert-persistent" style="background: #f8f9fa; border-color: #dee2e6 !important;">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        {% trans "Team and jersey number will be assigned by an administrator or manager." %}
                    </small>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.position.id_for_label }}" class="form-label">
                            {% trans "Primary Position" %}
                        </label>
                        {{ parent_player_form.position }}
                        {% if parent_player_form.position.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.position.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.secondary_position.id_for_label }}" class="form-label">
                            {% trans "Secondary Position" %}
                        </label>
                        {{ parent_player_form.secondary_position }}
                        {% if parent_player_form.secondary_position.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.secondary_position.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label d-block">
                            {% trans "Are you a pitcher?" %}
                        </label>
                        <div class="form-check">
                            {{ parent_player_form.is_pitcher }}
                            <label class="form-check-label" for="{{ parent_player_form.is_pitcher.id_for_label }}">
                                {% trans "Yes, I am a pitcher" %}
                            </label>
                        </div>
                        {% if parent_player_form.is_pitcher.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.is_pitcher.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.height.id_for_label }}" class="form-label">
                            {% trans "Height" %}
                        </label>
                        {{ parent_player_form.height }}
                        {% if parent_player_form.height.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.height.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">{% trans "Ex: 5'10\"" %}</small>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.weight.id_for_label }}" class="form-label">
                            {% trans "Weight (lbs)" %}
                        </label>
                        {{ parent_player_form.weight }}
                        {% if parent_player_form.weight.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.weight.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.batting_hand.id_for_label }}" class="form-label required-field">
                            {% trans "Batting Hand" %} *
                        </label>
                        {{ parent_player_form.batting_hand }}
                        {% if parent_player_form.batting_hand.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.batting_hand.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.throwing_hand.id_for_label }}" class="form-label required-field">
                            {% trans "Throwing Hand" %} *
                        </label>
                        {{ parent_player_form.throwing_hand }}
                        {% if parent_player_form.throwing_hand.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.throwing_hand.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Elegibilidad y División -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-check-circle me-2" style="color: var(--mlb-red);"></i>{% trans "Eligibility and Division" %}
                </h5>
                <div class="alert alert-warning border mb-3 alert-persistent" style="background: #fff3cd; border-color: #ffc107 !important;">
                    <small>
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        <strong>{% trans "Required:" %}</strong> {% trans "Grade and Division are required fields. They will be calculated automatically based on birth date, but you can modify them if needed." %}
                    </small>
                </div>
                <div class="alert alert-info border mb-3 alert-persistent" style="background: #e7f3ff; border-color: #0dcaf0 !important;">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        {% trans "Players without approved age verification are not eligible until documentation is approved." %}
                    </small>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.grade.id_for_label }}" class="form-label required-field">
                            {% trans "Current Grade" %} *
                        </label>
                        {{ parent_player_form.grade }}
                        {% if parent_player_form.grade.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.grade.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.grade.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.grade.errors }}</div>
                        {% endif %}
                        <small class="text-success d-block mt-1">
                            <i class="fas fa-magic me-1"></i>{% trans "Will be calculated automatically" %}
                        </small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.division.id_for_label }}" class="form-label required-field">
                            {% trans "Assigned Division" %} *
                        </label>
                        {{ parent_player_form.division }}
                        {% if parent_player_form.division.help_text %}
                            <small class="text-muted d-block mt-1">
                                <i class="fas fa-info-circle me-1"></i>{{ parent_player_form.division.help_text }}
                            </small>
                        {% endif %}
                        {% if parent_player_form.division.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.division.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">{% trans "Assigned automatically or by administrator" %}</small>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="{{ parent_player_form.age_verification_document.id_for_label }}" class="form-label" style="font-weight: 700; color: var(--mlb-blue); font-size: 1.05rem; margin-bottom: 12px;">
                        <i class="fas fa-file-upload me-2" style="color: var(--mlb-red);"></i>{% trans "Age Verification Document" %}
                    </label>
                    <div class="file-upload-area" id="ageVerificationUploadArea" style="border: 3px dashed var(--mlb-blue); border-radius: 12px; padding: 30px; text-align: center; background: linear-gradient(135deg, #f8f9fa 0%, #e7f3ff 100%); cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;" onmouseover="this.style.borderColor='var(--mlb-red)'; this.style.background='linear-gradient(135deg, #e7f3ff 0%, #fff5f5 100%)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(13, 44, 84, 0.15)';" onmouseout="this.style.borderColor='var(--mlb-blue)'; this.style.background='linear-gradient(135deg, #f8f9fa 0%, #e7f3ff 100%)'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        <div style="position: relative; z-index: 2;">
                            <i class="fas fa-cloud-upload-alt fa-3x mb-3" style="color: var(--mlb-blue); animation: pulse 2s ease-in-out infinite;"></i>
                            <p class="mb-2" style="font-weight: 700; color: var(--mlb-blue); font-size: 1.1rem;">{% trans "Click to upload document" %}</p>
                            <small class="text-muted d-block mt-2" style="font-size: 0.9rem;">{% trans "PDF, JPG, PNG (max. 10MB)" %}</small>
                            <small class="text-muted d-block mt-1" style="font-size: 0.85rem;">{% trans "Birth certificate, passport or ID (original or digital)" %}</small>
                        </div>
                        {{ parent_player_form.age_verification_document }}
                        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(45deg, rgba(13, 44, 84, 0.05) 0%, rgba(213, 0, 50, 0.05) 100%); z-index: 1; pointer-events: none;"></div>
                    </div>
                    {% if parent_player_form.age_verification_document.help_text %}
                        <div class="alert alert-info mt-3 mb-0" style="background: #e7f3ff; border-left: 4px solid var(--mlb-blue); border-radius: 6px; padding: 12px;">
                            <small style="display: flex; align-items: center;">
                                <i class="fas fa-info-circle me-2" style="color: var(--mlb-blue);"></i>
                                <span>{{ parent_player_form.age_verification_document.help_text }}</span>
                            </small>
                        </div>
                    {% endif %}
                    {% if parent_player_form.age_verification_document.errors %}
                        <div class="alert alert-danger mt-3 mb-0" style="border-left: 4px solid var(--mlb-red); border-radius: 6px; padding: 12px;">
                            <small style="display: flex; align-items: center;">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <span>{{ parent_player_form.age_verification_document.errors }}</span>
                            </small>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Tallas de Uniformes -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-tshirt me-2" style="color: var(--mlb-red);"></i>{% trans "Uniform Sizes" %}
                </h5>
                <div class="alert alert-warning border mb-3 alert-persistent" style="background: #fff3cd; border-color: #ffc107 !important;">
                    <small>
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        <strong>{% trans "Required:" %}</strong> {% trans "All uniform sizes are required. Please select the appropriate sizes for each item." %}
                    </small>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.jersey_size.id_for_label }}" class="form-label required-field">
                            {% trans "Jersey Size" %} *
                        </label>
                        {{ parent_player_form.jersey_size }}
                        {% if parent_player_form.jersey_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.jersey_size.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.hat_size.id_for_label }}" class="form-label required-field">
                            {% trans "Hat Size" %} *
                        </label>
                        {{ parent_player_form.hat_size }}
                        {% if parent_player_form.hat_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.hat_size.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.batting_glove_size.id_for_label }}" class="form-label required-field">
                            {% trans "Batting Glove Size" %} *
                        </label>
                        {{ parent_player_form.batting_glove_size }}
                        {% if parent_player_form.batting_glove_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.batting_glove_size.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.batting_helmet_size.id_for_label }}" class="form-label required-field">
                            {% trans "Batting Helmet Size" %} *
                        </label>
                        {{ parent_player_form.batting_helmet_size }}
                        {% if parent_player_form.batting_helmet_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.batting_helmet_size.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ parent_player_form.shorts_size.id_for_label }}" class="form-label required-field">
                            {% trans "Pants Size" %} *
                        </label>
                        {{ parent_player_form.shorts_size }}
                        {% if parent_player_form.shorts_size.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.shorts_size.errors }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Contacto de Emergencia -->
            <div class="form-section mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <h5 class="mb-3" style="color: var(--mlb-blue); font-weight: 600; font-size: 1.1rem;">
                    <i class="fas fa-phone-alt me-2" style="color: var(--mlb-red);"></i>{% trans "Emergency Contact" %}
                </h5>
                <div class="alert alert-light border mb-3 alert-persistent" style="background: #f8f9fa; border-color: #dee2e6 !important;">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        {% trans "Information used only in case of medical emergency." %}
                    </small>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.emergency_contact_name.id_for_label }}" class="form-label required-field">
                            {% trans "Contact Name" %} *
                        </label>
                        {{ parent_player_form.emergency_contact_name }}
                        {% if parent_player_form.emergency_contact_name.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.emergency_contact_name.errors }}</div>
                        {% endif %}
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.emergency_contact_phone.id_for_label }}" class="form-label required-field">
                            {% trans "Emergency Phone" %} *
                        </label>
                        {{ parent_player_form.emergency_contact_phone }}
                        {% if parent_player_form.emergency_contact_phone.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.emergency_contact_phone.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">{% trans "24/7 available number" %}</small>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="{{ parent_player_form.emergency_contact_relation.id_for_label }}" class="form-label required-field">
                            {% trans "Relationship with Player" %} *
                        </label>
                        {{ parent_player_form.emergency_contact_relation }}
                        {% if parent_player_form.emergency_contact_relation.errors %}
                            <div class="error-message mt-1">{{ parent_player_form.emergency_contact_relation.errors }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="mb-3">
                    <label for="{{ parent_player_form.medical_conditions.id_for_label }}" class="form-label required-field">
                        {% trans "Medical Conditions" %} *
                    </label>
                    {{ parent_player_form.medical_conditions }}
                    {% if parent_player_form.medical_conditions.errors %}
                        <div class="error-message mt-1">{{ parent_player_form.medical_conditions.errors }}</div>
                    {% endif %}
                    <small class="text-muted d-block mt-1">
                        <i class="fas fa-info-circle me-1"></i>
                        {% trans "Allergies, asthma, medications, etc. If there are no conditions, write \"None\"." %}
                    </small>
                </div>
            </div>

            <!-- Botones de Acción -->
            <div class="form-actions mb-4" style="background: white; border-radius: 12px; padding: 25px; border: 1px solid #e9ecef;">
                <div class="d-flex justify-content-between align-items-center">
                    <a href="{% url 'panel' %}" class="btn btn-form-cancel">
                        <i class="fas fa-times me-2"></i>{% trans "Cancel" %}
                    </a>
                    <button type="submit" class="btn btn-form-submit" id="btnSubmitPlayer">
                        <span class="button-text">
                            <i class="fas fa-save me-2"></i>{% trans "Register Player" %}
                        </span>
                        <span class="button-spinner" style="display: none;">
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            {% trans "Saving..." %}
                        </span>
                    </button>
                </div>
            </div>
        </form>
    </div>
{% endif %}

<!-- Barra de progreso flotante del formulario -->
<div id="formFloatingProgressBar" style="position: fixed !important; bottom: 0 !important; left: 0 !important; width: 100% !important; height: 8px !important; background: rgba(0, 0, 0, 0.2) !important; z-index: 99998 !important; display: block !important; visibility: visible !important; opacity: 1 !important; margin: 0 !important; padding: 0 !important; overflow: visible !important; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1) !important;">
    <div id="formFloatingProgressBarInner" style="height: 100% !important; width: 0% !important; background: linear-gradient(90deg, var(--mlb-blue) 0%, var(--mlb-red) 50%, var(--mlb-blue) 100%) !important; background-size: 200% 100% !important; transition: width 0.3s ease !important; box-shadow: 0 0 20px rgba(13, 44, 84, 0.6) !important; position: relative !important; display: block !important; animation: progressBarGradient 3s linear infinite !important;"></div>
    <div style="position: absolute !important; top: -30px !important; right: 20px !important; background: rgba(13, 44, 84, 0.95) !important; color: white !important; padding: 8px 16px !important; border-radius: 8px !important; font-size: 0.85rem !important; font-weight: 600 !important; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important; backdrop-filter: blur(10px) !important; -webkit-backdrop-filter: blur(10px) !important;" id="formProgressTextFloating">0%</div>
</div>

<style>
@keyframes progressBarGradient {
    0% { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.8; }
}

#formFloatingProgressBar {
    pointer-events: none !important;
}

#formFloatingProgressBar:hover {
    height: 10px !important;
}

#formFloatingProgressBar:hover #formFloatingProgressBarInner {
    box-shadow: 0 0 30px rgba(13, 44, 84, 0.8) !important;
}

@media (max-width: 768px) {
    #formFloatingProgressBar {
        height: 6px !important;
    }

    #formFloatingProgressBar:hover {
        height: 8px !important;
    }

    #formProgressTextFloating {
        top: -28px !important;
        right: 10px !important;
        font-size: 0.75rem !important;
        padding: 6px 12px !important;
    }
}
</style>

<script>
// Traducciones para JavaScript - Verificar si ya existe para evitar redeclaración
if (typeof translations === 'undefined') {
    var translations = {};
}

// Agregar traducciones del formulario de registro
Object.assign(translations, {
    fileTooLarge: "{{ 'The file is too large. Maximum size allowed is 10MB.'|escapejs }}",
    fileTypeNotAllowed: "{{ 'File type not allowed. Only PDF, JPG or PNG are accepted.'|escapejs }}",
    documentUploaded: "{{ 'Document Uploaded'|escapejs }}",
    clickToChangeFile: "{{ 'Click to change file'|escapejs }}",
    pleaseCompleteFields: "{{ 'Please complete all required fields'|escapejs }}"
});

// Función global de inicialización del formulario de registro de hijo
window.initParentPlayerForm = function() {
    // ========== FUNCIONALIDAD DEL FORMULARIO ==========

    // Calcular progreso del formulario
    function updateFormProgress() {
        const form = document.getElementById('parentPlayerForm');
        if (!form) return;

        // Obtener todos los campos requeridos
        const requiredInputs = form.querySelectorAll('input[required], select[required], textarea[required]');
        const requiredLabels = form.querySelectorAll('.required-field');

        let totalRequired = requiredInputs.length;
        requiredLabels.forEach(label => {
            const fieldId = label.getAttribute('for');
            if (fieldId) {
                const field = document.getElementById(fieldId);
                if (field && !field.hasAttribute('required')) {
                    totalRequired++;
                }
            }
        });

        // Contar campos llenos
        let filledCount = 0;
        requiredInputs.forEach(input => {
            if (input.value && input.value.trim() !== '') {
                filledCount++;
            }
        });

        requiredLabels.forEach(label => {
            const fieldId = label.getAttribute('for');
            if (fieldId) {
                const field = document.getElementById(fieldId);
                if (field && !field.hasAttribute('required') && field.value && field.value.trim() !== '') {
                    filledCount++;
                }
            }
        });

        const progress = totalRequired > 0 ? (filledCount / totalRequired) * 100 : 0;
        const progressBar = document.getElementById('formProgressBar');
        const progressText = document.getElementById('formProgressText');

        // Actualizar barra flotante
        const floatingProgressBar = document.getElementById('formFloatingProgressBarInner');
        const floatingProgressText = document.getElementById('formProgressTextFloating');

        if (progressBar) {
            progressBar.style.width = progress + '%';
        }

        if (progressText) {
            progressText.textContent = Math.round(progress) + '%';
        }

        // Actualizar barra flotante
        if (floatingProgressBar) {
            floatingProgressBar.style.width = progress + '%';
        }

        if (floatingProgressText) {
            floatingProgressText.textContent = Math.round(progress) + '%';
        }
    }

    // Actualizar progreso cuando cambian los campos
    const form = document.getElementById('parentPlayerForm');
    if (form) {
        form.addEventListener('input', updateFormProgress);
        form.addEventListener('change', updateFormProgress);
        updateFormProgress();
    }

    // Cálculo automático de división y grado basado en fecha de nacimiento
    const birthDateField = document.getElementById('id_child-birth_date');
    const gradeField = document.getElementById('id_child-grade');
    const divisionField = document.getElementById('id_child-division');

    // Función para convertir formato de fecha a ISO
    function convertDateToISO(dateField) {
        if (!dateField || !dateField.value) return;

        const currentValue = dateField.value.trim();

        // Verificar si está en formato DD/MM/YYYY o DD-MM-YYYY
        const datePattern = /^(\d{2})[\/\-](\d{2})[\/\-](\d{4})$/;
        const match = currentValue.match(datePattern);

        if (match) {
            // Convertir de DD/MM/YYYY a YYYY-MM-DD
            const day = match[1];
            const month = match[2];
            const year = match[3];
            dateField.value = `${year}-${month}-${day}`;
        }
    }

    // Campo de fecha simple - el navegador maneja el formato local automáticamente
    if (birthDateField) {
        // Asegurar que sea tipo date para mostrar calendario
        birthDateField.type = 'date';

        // Convertir el valor inicial inmediatamente
        convertDateToISO(birthDateField);

        // También convertir cuando cambie el valor (por si se establece después)
        birthDateField.addEventListener('input', function() {
            convertDateToISO(this);
        });

        // Usar MutationObserver para detectar cambios en el atributo value
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'value') {
                    convertDateToISO(birthDateField);
                }
            });
        });

        observer.observe(birthDateField, {
            attributes: true,
            attributeFilter: ['value']
        });

        // Ejecutar conversión después de un pequeño delay para asegurar que el valor esté establecido
        setTimeout(function() {
            convertDateToISO(birthDateField);
        }, 100);
    }

    if (birthDateField && gradeField && divisionField) {

        function calculateAgeAsOfApril30(birthDate) {
            if (!birthDate) return null;

            const date = new Date(birthDate);

            if (isNaN(date.getTime())) {
                return null;
            }

            const today = new Date();
            const currentYear = today.getFullYear();
            const cutoffDate = new Date(currentYear, 3, 30); // Mes 3 = abril (0-indexed)

            let age = cutoffDate.getFullYear() - date.getFullYear();
            const monthDiff = cutoffDate.getMonth() - date.getMonth();

            if (monthDiff < 0 || (monthDiff === 0 && cutoffDate.getDate() < date.getDate())) {
                age -= 1;
            }

            return age;
        }

        function getAgeBasedDivision(age) {
            if (age === null || age === undefined || age < 5) return null;
            if (age >= 18) return '18U';

            const divisionMap = {
                5: '05U', 6: '06U', 7: '07U', 8: '08U', 9: '09U',
                10: '10U', 11: '11U', 12: '12U', 13: '13U', 14: '14U',
                15: '15U', 16: '16U', 17: '17U',
            };

            return divisionMap[age] || null;
        }

        function suggestGradeFromAge(age) {
            if (age === null || age === undefined) return null;

            const ageToGradeMap = {
                4: 'pre_k', 5: 'kindergarten', 6: '1st', 7: '2nd', 8: '3rd',
                9: '4th', 10: '5th', 11: '6th', 12: '7th', 13: '8th',
                14: '9th', 15: '10th', 16: '11th', 17: '12th', 18: '12th',
            };

            return ageToGradeMap[age] || null;
        }

        function updateDivisionAndGrade() {
            const birthDateValue = birthDateField.value;

            if (!birthDateValue) {
                if (divisionField && !divisionField.value) divisionField.value = '';
                if (gradeField && !gradeField.value) gradeField.value = '';
                return;
            }

            const birthDate = new Date(birthDateValue);

            if (isNaN(birthDate.getTime())) {
                return;
            }

            const age = calculateAgeAsOfApril30(birthDateValue);

            if (age !== null) {
                const suggestedDivision = getAgeBasedDivision(age);
                const suggestedGrade = suggestGradeFromAge(age);

                // Actualizar división
                if (divisionField && suggestedDivision) {
                    if (!divisionField.value || divisionField.value === '') {
                        divisionField.value = suggestedDivision;
                        divisionField.dataset.autoSet = 'true';
                    } else if (divisionField.dataset.autoSet === 'true') {
                        divisionField.value = suggestedDivision;
                    }
                }

                // Actualizar grado
                if (gradeField && suggestedGrade) {
                    const optionExists = Array.from(gradeField.options).some(opt => opt.value === suggestedGrade);
                    if (optionExists) {
                        const isEmpty = !gradeField.value || gradeField.value === '' || gradeField.value === null;
                        if (isEmpty || gradeField.selectedIndex === 0) {
                            gradeField.value = suggestedGrade;
                            gradeField.dataset.autoSet = 'true';
                            gradeField.dispatchEvent(new Event('change', { bubbles: true }));
                        } else if (gradeField.dataset.autoSet === 'true') {
                            gradeField.value = suggestedGrade;
                            gradeField.dispatchEvent(new Event('change', { bubbles: true }));
                        }
                    }
                }
            }
        }

        birthDateField.addEventListener('change', updateDivisionAndGrade);
        birthDateField.addEventListener('blur', updateDivisionAndGrade);
        birthDateField.addEventListener('input', function() {
            if (this.value) {
                setTimeout(updateDivisionAndGrade, 100);
            }
        });

        if (birthDateField.value) {
            updateDivisionAndGrade();
        }
    }

    // Mejorar el área de carga de archivos
    const fileInput = document.querySelector('#parentPlayerForm input[type="file"][name*="age_verification"]');
    const fileUploadArea = document.getElementById('ageVerificationUploadArea');

    if (fileInput && fileUploadArea) {
        // Asegurar que el input esté dentro del área de carga
        if (!fileUploadArea.contains(fileInput)) {
            fileInput.style.position = 'absolute';
            fileInput.style.width = '100%';
            fileInput.style.height = '100%';
            fileInput.style.opacity = '0';
            fileInput.style.cursor = 'pointer';
            fileInput.style.top = '0';
            fileInput.style.left = '0';
            fileUploadArea.appendChild(fileInput);
        }

        fileUploadArea.addEventListener('click', function(e) {
            if (e.target !== fileInput) {
                fileInput.click();
            }
        });

        // Asegurar que el campo no sea requerido
        fileInput.removeAttribute('required');
        fileInput.required = false;

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const fileName = file.name;
                const fileSize = (file.size / 1024 / 1024).toFixed(2);

                // Validar tamaño (máx 10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert(translations.fileTooLarge);
                    fileInput.value = '';
                    fileUploadArea.style.borderColor = 'var(--mlb-red)';
                    fileUploadArea.style.background = '#fff5f5';
                    setTimeout(() => {
                        fileUploadArea.style.borderColor = 'var(--mlb-blue)';
                        fileUploadArea.style.background = 'linear-gradient(135deg, #f8f9fa 0%, #e7f3ff 100%)';
                    }, 2000);
                    return;
                }

                // Validar tipo de archivo
                const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
                if (!allowedTypes.includes(file.type)) {
                    alert(translations.fileTypeNotAllowed);
                    fileInput.value = '';
                    fileUploadArea.style.borderColor = 'var(--mlb-red)';
                    fileUploadArea.style.background = '#fff5f5';
                    setTimeout(() => {
                        fileUploadArea.style.borderColor = 'var(--mlb-blue)';
                        fileUploadArea.style.background = 'linear-gradient(135deg, #f8f9fa 0%, #e7f3ff 100%)';
                    }, 2000);
                    return;
                }

                // Actualizar el área con el archivo cargado
                const contentDiv = fileUploadArea.querySelector('div[style*="position: relative"]');
                if (contentDiv) {
                    contentDiv.innerHTML = `
                        <i class="fas fa-check-circle fa-3x mb-3" style="color: #28a745; animation: none;"></i>
                        <p class="mb-2" style="font-weight: 700; color: #28a745; font-size: 1.1rem;">
                            <i class="fas fa-file-check me-2"></i>${translations.documentUploaded}
                        </p>
                        <p class="mb-1" style="font-weight: 600; color: var(--mlb-blue); font-size: 0.95rem; word-break: break-word;">${fileName}</p>
                        <small class="text-muted d-block mt-2" style="font-size: 0.9rem;">${fileSize} MB</small>
                        <small class="text-success d-block mt-1" style="font-size: 0.85rem;">
                            <i class="fas fa-check me-1"></i>${translations.clickToChangeFile}
                        </small>
                    `;
                }

                fileUploadArea.style.borderColor = '#28a745';
                fileUploadArea.style.borderWidth = '3px';
                fileUploadArea.style.background = 'linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)';
                fileUploadArea.style.boxShadow = '0 4px 12px rgba(40, 167, 69, 0.2)';

                console.log(`✅ Archivo de verificación de edad cargado: ${fileName} (${fileSize} MB)`);

                updateFormProgress();
            }
        });
    }

    // Validación antes de enviar
    if (form) {
        form.addEventListener('submit', function(e) {

            // Verificar campos requeridos
            const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');
            let isValid = true;
            let missingFields = [];

            requiredFields.forEach(field => {
                if (!field.value || field.value.trim() === '') {
                    isValid = false;
                    const label = form.querySelector(`label[for="${field.id}"]`);
                    const fieldName = label ? label.textContent.trim() : field.name;
                    missingFields.push(fieldName);
                    field.classList.add('is-invalid');
                } else {
                    field.classList.remove('is-invalid');
                }
            });

            if (!isValid) {
                e.preventDefault();
                alert(translations.pleaseCompleteFields + '\n\n' + missingFields.join('\n'));
                return false;
            }

            // Mostrar spinner en el botón
            const submitBtn = document.getElementById('btnSubmitPlayer');
            if (submitBtn) {
                const buttonText = submitBtn.querySelector('.button-text');
                const buttonSpinner = submitBtn.querySelector('.button-spinner');

                if (buttonText && buttonSpinner) {
                    buttonText.style.display = 'none';
                    buttonSpinner.style.display = 'inline-block';
                    submitBtn.disabled = true;
                    submitBtn.style.opacity = '0.7';
                    submitBtn.style.cursor = 'not-allowed';
                }
            }
        });
    }

    // ====== Manejo de Foto de Perfil ======
    const profilePictureInput = document.getElementById('id_child-profile_picture');
    const profilePictureUploadArea = document.getElementById('profilePictureUploadAreaPanel');

    if (profilePictureInput && profilePictureUploadArea) {

        // Hacer clic en el área activa el input de archivo
        profilePictureUploadArea.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            profilePictureInput.click();
        }, true);

        // Preview de la imagen seleccionada
        profilePictureInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {

                // Validar tamaño (5MB máximo)
                const maxSize = 5 * 1024 * 1024;
                if (file.size > maxSize) {
                    alert('El archivo es demasiado grande. El tamaño máximo es 5MB.');
                    profilePictureInput.value = '';
                    return;
                }

                // Validar tipo de archivo
                const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
                if (!allowedTypes.includes(file.type)) {
                    alert('Tipo de archivo inválido. Solo se permiten JPG, PNG y GIF.');
                    profilePictureInput.value = '';
                    return;
                }

                // Mostrar preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    profilePictureUploadArea.innerHTML = `
                        <div style="position: relative;">
                            <img src="${e.target.result}" alt="Vista previa" style="max-width: 200px; max-height: 200px; border-radius: 12px; object-fit: cover; margin-bottom: 15px;">
                            <div>
                                <i class="fas fa-check-circle fa-2x mb-2" style="color: #28a745;"></i>
                                <p class="mb-1" style="font-weight: 600; color: var(--mlb-blue);">
                                    Foto Seleccionada
                                </p>
                                <small class="text-success">${file.name} (${(file.size / 1024).toFixed(2)} KB)</small>
                                <br>
                                <small class="text-muted">Haz clic para cambiar la foto</small>
                            </div>
                        </div>
                    `;
                    profilePictureUploadArea.style.borderColor = '#28a745';
                    profilePictureUploadArea.style.background = 'linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)';
                };
                reader.readAsDataURL(file);

                updateFormProgress();
            }
        });

        // Hover effect
        profilePictureUploadArea.addEventListener('mouseenter', function() {
            this.style.borderColor = 'var(--mlb-red)';
            this.style.transform = 'scale(1.02)';
        });

        profilePictureUploadArea.addEventListener('mouseleave', function() {
            if (!profilePictureInput.files.length) {
                this.style.borderColor = '#0d2c54';
            }
            this.style.transform = 'scale(1)';
        });
    }

    // Filtros dinámicos de ubicación (Country -> State -> City)
    // Usar la referencia del formulario que ya existe (form ya está declarada arriba)
    const locationForm = document.getElementById('parentPlayerForm');
    if (locationForm) {
        const countrySelect = locationForm.querySelector('[name="child-country"], [name="country"]');
        const stateSelect = locationForm.querySelector('[name="child-state"], [name="state"]');
        const citySelect = locationForm.querySelector('[name="child-city"], [name="city"]');
        const stateLoader = locationForm.querySelector('#stateLoader');
        const cityLoader = locationForm.querySelector('#cityLoader');

    if (countrySelect && stateSelect && citySelect) {
            // Evitar inicialización duplicada
            if (countrySelect.dataset.locationInitialized === 'true') return;
            countrySelect.dataset.locationInitialized = 'true';

        // Guardar valores iniciales
        const initialCountry = countrySelect.value;
            const initialState = stateSelect.dataset.initialValue || stateSelect.value;
            const initialCity = citySelect.dataset.initialValue || citySelect.value;

            function updateStates(showLoader = true, preserveState = null) {
            const countryId = countrySelect.value;
                const currentStateValue = preserveState || stateSelect.value;

            // Limpiar estados y ciudades
            stateSelect.innerHTML = '<option value="">{{ "Select a state"|escapejs }}</option>';
            citySelect.innerHTML = '<option value="">{{ "Select a city"|escapejs }}</option>';

            if (countryId) {
                // Mostrar loader y deshabilitar select solo si no es la carga inicial
                if (showLoader && stateLoader) stateLoader.style.display = 'block';
                if (showLoader) {
                    stateSelect.disabled = true;
                    citySelect.disabled = true;
                }

                fetch(`/locations/ajax/states/${countryId}/`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (!Array.isArray(data) || data.length === 0) {
                            stateSelect.innerHTML = '<option value="">{{ "No states available"|escapejs }}</option>';
                            citySelect.innerHTML = '<option value="">{{ "Select a city"|escapejs }}</option>';
                            return;
                        }
                        data.forEach(state => {
                            const option = document.createElement('option');
                            option.value = state.id;
                            option.textContent = state.name;
                            if (currentStateValue == state.id) {
                                option.selected = true;
                            }
                            stateSelect.appendChild(option);
                        });
                        // Si había un estado seleccionado, actualizar ciudades
                            if (stateSelect.value) {
                                updateCities(showLoader, preserveState ? initialCity : null);
                        }
                    })
                    .catch(error => {
                            console.error('Error loading states:', error);
                        stateSelect.innerHTML = '<option value="">{{ "Error loading states"|escapejs }}</option>';
                    })
                    .finally(() => {
                        // Ocultar loader y habilitar select
                        if (stateLoader) stateLoader.style.display = 'none';
                        stateSelect.disabled = false;
                        citySelect.disabled = false;
                    });
            } else {
                // Si no hay país seleccionado, habilitar ambos selects
                stateSelect.disabled = false;
                citySelect.disabled = false;
            }
        }

            function updateCities(showLoader = true, preserveCity = null) {
            const stateId = stateSelect.value;
                const currentCityValue = preserveCity || citySelect.value;

            citySelect.innerHTML = '<option value="">{{ "Select a city"|escapejs }}</option>';

            if (stateId) {
                // Mostrar loader y deshabilitar select solo si no es la carga inicial
                if (showLoader && cityLoader) cityLoader.style.display = 'block';
                if (showLoader) citySelect.disabled = true;

                fetch(`/locations/ajax/cities/${stateId}/`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (!Array.isArray(data) || data.length === 0) {
                            citySelect.innerHTML = '<option value="">{{ "No cities available"|escapejs }}</option>';
                            return;
                        }
                        data.forEach(city => {
                            const option = document.createElement('option');
                            option.value = city.id;
                            option.textContent = city.name;
                            if (currentCityValue == city.id) {
                                option.selected = true;
                            }
                            citySelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                            console.error('Error loading cities:', error);
                        citySelect.innerHTML = '<option value="">{{ "Error loading cities"|escapejs }}</option>';
                    })
                    .finally(() => {
                        // Ocultar loader y habilitar select
                        if (cityLoader) cityLoader.style.display = 'none';
                        citySelect.disabled = false;
                    });
            } else {
                // Si no hay estado seleccionado, habilitar select
                citySelect.disabled = false;
            }
        }

        // Event listeners para cambios manuales del usuario
        countrySelect.addEventListener('change', function() {
            updateStates(true); // Mostrar loader en cambios manuales
        });

        stateSelect.addEventListener('change', function() {
            updateCities(true); // Mostrar loader en cambios manuales
        });

        // Cargar datos iniciales si hay un país seleccionado (sin loader ni bloqueo)
        if (initialCountry && stateSelect.options.length <= 1) {
                updateStates(false, initialState); // No mostrar loader en carga inicial, preservar estado
        }
    }
    }
};

// Inicializar cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
    window.initParentPlayerForm();
});

// También inicializar inmediatamente si el DOM ya está cargado (para contenido AJAX)
if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(window.initParentPlayerForm, 50);
}
</script>
